---
sidebar: sidebar 
permalink: use-codebox.html 
keywords: codebox, automation, cloudformation, rest api, aws cli, permissions 
summary: Codebox を使用すると、 NetApp Workload Factory でサポートされているあらゆる操作を実行するために必要なコードを生成できます。 
---
= NetApp Workload Factory の自動化に Codebox を使用する
:allow-uri-read: 
:icons: font
:imagesdir: ./media/


[role="lead"]
Codebox を使用すると、 NetApp Workload Factory でサポートされているあらゆる操作を実行するために必要なコードを生成できます。  Workload Factory REST API、AWS CLI、AWS CloudFormation を使用して使用および実行できるコードを生成できます。

Codebox は、各ユーザーの Workload Factory アカウントに提供されている AWS 権限に基づいてコードに適切なデータを入力することで、Workload Factory の操作モード (_基本_、_読み取り専用_、および _読み取り/書き込み_) と連携します。コードはテンプレートのように使用でき、不足している情報 (資格情報など) を入力したり、コードを実行する前に特定のデータをカスタマイズしたりできます。



== Codeboxの使用方法

Workload Factory UI ウィザードに値を入力すると、各フィールドの入力が完了すると Codebox でデータの更新を確認できます。ウィザードを完了した後、ページの下部にある*作成*ボタンを選択する前に、image:button-copy-codebox.png["コピーボタン"]構成を構築するために必要なコードをキャプチャするために、Codebox にコピーします。たとえば、新しい Microsoft SQL Server を作成するときのこのスクリーンショットには、VPC とアベイラビリティーゾーンのウィザード エントリと、REST API 実装の Codebox 内の同等のエントリが表示されています。

image:screenshot-codebox-example1.png["UIでMicrosoft SQL Serverを作成する方法、およびCodeboxのVPCゾーンとアベイラビリティゾーンに対応するエントリを示すスクリーンショット。"]

一部のコード形式では、ダウンロード ボタンを選択して、コードをファイルに保存し、別のシステムに持ち込むこともできます。必要に応じて、ダウンロード後にコードを編集して、他の AWS アカウントに適合させることができます。



== CodeboxからCloudFormationコードを使用

Codebox から生成された CloudFormation コードをコピーし、AWS アカウントで Amazon Web Services CloudFormation スタックを起動できます。  CloudFormation は、Workload Factory UI で定義したアクションを実行します。

CloudFormation コードを使用する手順は、FSx for ONTAPファイルシステムをデプロイするのか、アカウント認証情報を作成するのか、それとも他の Workload Factory アクションを実行するのかによって異なる場合があります。

CloudFormationによって生成されたYAMLファイル内のコードは、セキュリティ上の理由から7日後に期限切れになります。

.開始する前に
* AWSアカウントにログインするにはクレデンシャルが必要です。
* CloudFormationスタックを使用するには、次のユーザー権限が必要です。
+
[%collapsible]
====
[source, json]
----
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "cloudformation:CreateStack",
                "cloudformation:UpdateStack",
                "cloudformation:DeleteStack",
                "cloudformation:DescribeStacks",
                "cloudformation:DescribeStackEvents",
                "cloudformation:DescribeChangeSet",
                "cloudformation:ExecuteChangeSet",
                "cloudformation:ListStacks",
                "cloudformation:ListStackResources",
                "cloudformation:GetTemplate",
                "cloudformation:ValidateTemplate",
                "lambda:InvokeFunction",
                "iam:PassRole",
                "iam:CreateRole",
                "iam:UpdateAssumeRolePolicy",
                "iam:AttachRolePolicy",
                "iam:CreateServiceLinkedRole"
            ],
            "Resource": "*"
        }
    ]
}
----
====


.手順
. Workload Factory コンソールを使用して実行する操作を定義したら、コードボックス内のコードをコピーします。
. [Redirect to CloudFormation]*を選択すると、[Redirect to CloudFormation]ページが表示されます。
. 別のブラウザウィンドウを開き、AWS管理コンソールにログインします。
. [Redirect to CloudFormation]ページから[Continue]*を選択します。
. コードを実行するAWSアカウントにログインします。
. [Quick create stack]ページの[Capabilities]で、*[I acknowledge that AWS CloudFormation may...]*を選択します。
. [スタックの作成]*を選択します。
. AWS または Workload Factory から進行状況を監視します。




== CodeboxからREST APIコードを使用する

Codebox から生成された Workload Factory REST API を使用して、FSx for ONTAPファイルシステムやその他の AWS リソースをデプロイおよび管理できます。

APIは、curlをサポートし、インターネットに接続された任意のホストから実行できます。

認証トークンはCodeboxでは非表示になっていますが、API呼び出しをコピーして貼り付けると入力されます。

.手順
. Workload Factory コンソールを使用して実行する操作を定義したら、Codebox に API コードをコピーします。
. コードを貼り付けて、ホストシステムで実行します。




== CodeboxからAWS CLIコードを使用

Codeboxから生成されたAmazon Web Services CLIを使用して、FSx for ONTAPファイルシステムやその他のAWSリソースを導入および管理できます。

.手順
. Workload Factory コンソールを使用して実行する操作を定義したら、Codebox に AWS CLI をコピーします。
. 別のブラウザウィンドウを開き、AWS管理コンソールにログインします。
. コードを貼り付けて実行します。




== コードボックスからTerraformを使用

Terraformを使用して、FSx for ONTAPファイルシステムやその他のAWSリソースを導入、管理できます。

.開始する前に
* Terraformがインストールされているシステム(Windows/Mac/Linux)が必要です。
* AWSアカウントにログインするにはクレデンシャルが必要です。


.手順
. Workload Factory コンソールを使用して実行する操作を定義したら、Codebox から Terraform コードをダウンロードします。
. ダウンロードしたスクリプトアーカイブをTerraformがインストールされているシステムにコピーします。
. zipファイルを展開し、README.mdファイルの手順に従います。

